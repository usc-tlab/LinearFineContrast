function [im, pcoutofrng] = LookupFromLuminance(im_lum, transCLUT, cal)% function [im, pcoutofrng] = LookupFromLuminance(im, transCLUT, cal)% % Translate from an gray scale image of in normalized% luminance units to an rgb image for the attenuator by table lookup % (and hence much faster running L2V on each pixel) % 6/02 BT wrote it% 10/13 BT: calculated the percentage of the out of range pixels% figure out min luminance and step size by interpolating 5 pts on transCLUTentrymax = size(transCLUT,1)-1;entries = round((0.1:0.2:0.9)*entrymax);lums = v2l(transCLUT(entries+1,:),cal);a = [entries' ones(size(entries'))]\lums;ldelta = a(1);lmin = a(2);imgray = round((im_lum-lmin)/ldelta);pcoutofrng = 0;outofrng = sum(imgray(:)<0)+sum(imgray(:)>entrymax);if outofrng	pcoutofrng = 100*outofrng/prod(size(imgray));	imgray(imgray<0) = 0;	imgray(imgray>entrymax)=entrymax;endim = LookupFromGray(imgray,transCLUT);